---
  title: "ThreeME Standard results"
subtitle: "Sc√©nario: `r params$scenario_name`"
author: "ThreeME team"
date: "`r format(Sys.Date(), '%d %B %y')`"
output: slidy_presentation
params:
  startyear: 2020
endyear: 2050
scenario_name: oilprice_fra
classification: c28_s32
template_default: ofce
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(
echo = FALSE,
message = FALSE,
warning = FALSE,
results = "hide"
)
```

```{r Plots default options}
startyear <- params$startyear
endyear <- params$endyear
scenario_name <- params$scenario_name
classification <- params$classification
template_default <- params$template_default
```




```{r Required packages, message=FALSE, warning=FALSE}

source("src/functions.R")
data_full<-readRDS(file = paste0("databases/",scenario_name,"_",classification,".rds"))
### loading the sector and commodity aggregated database 
data_sector <- readRDS(file = paste0("databases/",scenario_name,"_",classification,"_commodities_sectors.rds"))


source("bridges/bridge_c28_s32.R")
source("bridges/codenames_c28_s32.R")
```
---

# Macroeconomic results
## Impact on GDP and its component

```{r Graph GDP,  fig.height = 6, fig.width = 14}
label_macro <- c("Gross domestic product", "Households consumption", "Investment", "Public spending")
A <- simpleplot(data_full,c("GDP", "CH", "I", "G"), label_macro, startyear, endyear, titleplot = "GDP and its components  (in difference from baseline)")

B <- simpleplot(data_full,c("X", "M"),label_series = c("Exports", "Imports"), startyear, endyear, titleplot = "External trade  (in difference from baseline)")


macro <- ggarrange(A,B,
labels = c("(a)", "(b)"),
hjust = -0.5, vjust = 1.5,
ncol = 2, nrow = 1,
widths = 2,  heights = 1)

## Save image on disk for further use (ready to be activated)
# ggsave("macro.svg", device = svg, width = 32,  height = 16, units = c("cm"))


## See the graph in Mark-down
macro


```

---

```{r Table macro,  fig.height = 6, fig.width = 14}

#table.output(data = data_sector, scenario = scenario_name, 
#full.table = TRUE, export.doc = FALSE, language = "en", title = 'Macroeconomic main results')

```

---

## Contribution to growth (in deviation)
Decomposing the effect of the GDP by contribution of its components leads to the following results:

```{r contrib Graphs, fig.height = 3, fig.width=7}
GDP_comp <- c( "CH","X","M", "I", "G","DS")
GDP_comp_label <- c( "Households consumption","Exports","Imports", "Investment", "Public spending","Stock variation")

data_plot <-  contrib(data_full,"GDP", GDP_comp, scenar = c("baseline",scenario_name))

contrib.plot(data_plot, series = GDP_comp, 
label_series = GDP_comp_label,
startyear = 2020, titleplot = "Contributions to GDP gowth (in difference from baseline)", line_tot = TRUE)

```
---

## Contribution to growth (in yearly growth rate)
```{r Graph Macro Growth contrib, fig.height = 3, fig.width=7}

data_plot <-  contrib(data_full,"GDP", GDP_comp, scenar = c("baseline", "oilprice_fra"), indicator = "gr.diff")

contrib.plot(data_plot, series = GDP_comp, 
label_series = GDP_comp_label,
line_tot = TRUE,
startyear = 2020,
titleplot = "Contributions to GDP growth rate (in pp)")
```
---

## Growth rate
```{r Graph Macro Growth rate, fig.height = 3, fig.width=7}

A <- simpleplot(data_full,c("GDP", "CH", "I", "G"), label_macro, startyear, endyear, "gr", titleplot = "GDP and its components (growth rates)")

B <- simpleplot(data_full,c("X", "M"), c("Exports", "Imports"), startyear, endyear, "gr", titleplot = "External trade (growth rates)")

ggarrange(A,B,
labels = c("(a)", "(b)"),
hjust = -0.5, vjust = 1.5,
ncol = 2, nrow = 1,
widths = 2,  heights = 1)

```
---

## Effects on the production and the value added (2)

```{r ProdVA2, fig.height = 3, fig.width=7}

B <- curve_sc_plot(data_sector,"Y", growth.rate = FALSE,diff = TRUE,abs.diff = FALSE, title = "Production by sector (in difference from baseline)")

C <- curve_sc_plot(data_sector,"VA",diff=TRUE,growth.rate = FALSE,abs.diff = FALSE,title = " Added value by sector (in difference from baseline)")

ggarrange(B,C,
labels = c("(a)", "(b)"),
hjust = -0.5, vjust = 1.5,
ncol = 2, nrow = 1,
widths = 2,  heights = 1)


```

---
## Employment

```{r emploi, fig.height = 3, fig.width=7}

C <- simpleplot(data_full,"UNR", label_series = "Unemployment", startyear, endyear,"diff", unit = 100, titleplot = "Unemployment rate (in difference from baseline)")
D <- simpleplot(data_full,"F_L", label_series = "Labor", startyear, endyear, "diff", unit = 1000, decimal = 1, titleplot = "Employment (in difference from baseline)")

E<- curve_sc_plot(data_sector,"F_L",diff=TRUE,abs.diff = TRUE,title = "Employment by sector (in difference from baseline)")
G <- simpleplot(data_full,"UNR","Unemployment rate", startyear, endyear, "level", titleplot = "Unemployment rate ")
ggarrange(C,D,G,E,
labels = c("(a)", "(b)", "(c)", "(d)"),
hjust = -0.5, vjust = 1.5,
ncol = 2, nrow = 2,
widths = 2,  heights = 1)

```

## Effects on prices and wages 

```{r Graph Prices, fig.height = 3, fig.width=7}
label_prices <- c("Consumption", "Production", "Value added","Imports", "Exports")
A <- simpleplot(data_full,c("PCH", "PY", "PVA", "PM", "PX"),label_prices, startyear, endyear, titleplot = "Prices (in difference from baseline)")
B <- simpleplot(data_full,"W", label_series = "wage", startyear, endyear, titleplot = "Gross nominal wages (in difference from baseline)")

prix_salaires <- ggarrange(A,B,
                           labels = c("(a)", "(b)"),
                           hjust =-0.5, vjust = 1.5,
                           ncol = 2, nrow = 1,
                           widths = 2,  heights = 1)
prix_salaires
```

---

# Sectoral results
## On Value Added

```{r Prod 1, fig.height = 3, fig.width=7}
data_plot <- contrib.sub(data_sector,var1 =  "Y",
group_type = "sector", scenar = c("baseline", scenario_name))

contrib.sub.plot(data_plot, template = "ofce", startyear = 2020, endyear = 2050, line_tot =  TRUE, titleplot = "Total production and sectorial decomposition  (in difference from baseline)")

```

---
## On Value Added

```{r VA 1, fig.height = 3, fig.width=7}
data_plot <- contrib.sub(data_sector,var1 =  "VA",
group_type = "sector", scenar = c("baseline", scenario_name))

contrib.sub.plot(data_plot, template = "ofce", startyear = 2020, endyear = 2050, line_tot =  TRUE, titleplot = "Total Value Added and sectorial decomposition  (in difference from baseline)")

```

---

## On Investment

```{r Inv 1, fig.height = 3, fig.width=7}
data_plot <- contrib.sub(data_sector,var1 =  "I",
group_type = "sector", scenar = c("baseline", scenario_name))

contrib.sub.plot(data_plot, template = "ofce", startyear = 2020, endyear = 2050, line_tot =  TRUE, titleplot = "Total investment and sectorial decomposition  (in difference from baseline)")

```
---


# CO2 Emissions

```{r barplots for sectors, fig.height = 3, fig.width=7}
## compute CO2 emission per sector
data_CO2 <- data_sector %>% filter(year %in% (startyear:endyear)) %>% filter(grepl("^EMS_.+_CO2_S.*$",variable)) %>% 
mutate(variable = str_remove(variable,"_(CI|MAT|Y)")) %>% 
group_by(year,sector,variable) %>% 
summarise_at(all_of(c("baseline",scenario_name)), sum) %>% ungroup()

A <- stacked_sc_plot(data_CO2,"EMS_CO2",interval = 5, diff = TRUE, title = "CO2 emissions by sector (in difference from baseline)", bridge4palette_sectors = bridge_sectors)

D <- simpleplot(data_full,"EMS_CO2", label_series = "CO2 Emissions", startyear, endyear, titleplot = "CO2 Emissions (in difference from baseline)")

E <- simpleplot(data_full,"EMS_CO2", label_series = "CO2 Emissions", startyear, endyear, transformation = "level", unit =  1, decimal = 1, titleplot = "CO2 Emissions")

ggarrange(E,D,
labels = c("(a)", "(b)"),
hjust = -0.5, vjust = 1.5,
ncol = 2, nrow = 1,
widths = 2,  heights = 1)


```
---
# Energy results

```{r demande en produits energetiques, fig.height = 6, fig.width = 14}

energy_price <- simpleplot(data_full,c("PQ_CGAS", "PQ_CCOI"), c("Gas prices","Crude oil prices"), startyear, endyear, titleplot = " Shock on gas and oil prices (in difference from baseline)")
energy_price_bis <- simpleplot(data_full,c("PQ_CGAS", "PQ_CCOI"), c("Gas prices","Crude oil prices"), startyear, endyear, titleplot = " Shock on gas and oil prices (levels)",transformation = "level", unit=1)

energy_demand <- simpleplot(data_full,c("Q_CGAS", "Q_CCOI"), c("Gas","Crude oil"), startyear, endyear, titleplot = " Demand for gas and oil (in difference from baseline)")
energy_demand_bis <- simpleplot(data_full,c("Q_CGAS", "Q_CCOI"), c("Gas","Crude oil"), startyear, endyear, titleplot = " Demand on gas and oil (levels)",transformation = "level", unit=1)

energy <- ggarrange(energy_price,energy_price_bis,energy_demand,energy_demand_bis,
labels = c("(a)", "(b)",'(c)',"(d)"),
hjust = -0.5, vjust = 1.5,
ncol = 2, nrow = 2,
widths = 2,  heights = 1)

energy

```
---









